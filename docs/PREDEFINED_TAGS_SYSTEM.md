# üè∑Ô∏è Sistema de Etiquetas Predefinidas - Documentaci√≥n Completa

## üìã Tabla de Contenidos

1. [Resumen General](#resumen-general)
2. [Arquitectura](#arquitectura)
3. [Componentes](#componentes)
4. [Etiquetas Predefinidas](#etiquetas-predefinidas)
5. [Sugerencias Autom√°ticas](#sugerencias-autom√°ticas)
6. [Uso e Integraci√≥n](#uso-e-integraci√≥n)
7. [API Reference](#api-reference)
8. [Testing](#testing)

---

## üéØ Resumen General

Sistema completo de gesti√≥n de etiquetas para productos con:

- ‚úÖ **17 etiquetas predefinidas** organizadas en 6 categor√≠as
- ‚úÖ **Colores personalizados** con validaci√≥n hex
- ‚úÖ **Sugerencias autom√°ticas** basadas en stock, precio y fecha
- ‚úÖ **UI moderna** con modal de gesti√≥n y selector visual
- ‚úÖ **Etiquetas personalizadas** con picker de color
- ‚úÖ **Filtrado din√°mico** en la p√°gina de productos
- ‚úÖ **Actualizaci√≥n en tiempo real** sin recargar p√°gina

### Archivos Creados/Modificados

```
lib/
  predefinedTags.ts              ‚Üê 220+ l√≠neas (utilidades y definiciones)
components/products/
  TagManager.tsx                 ‚Üê 300+ l√≠neas (modal de gesti√≥n)
  TagSuggestions.tsx             ‚Üê 80+ l√≠neas (sugerencias autom√°ticas)
  ProductModal.tsx               ‚Üê Modificado (integraci√≥n)
  ProductCard.tsx                ‚Üê Modificado (display)
app/products-modern/
  page.tsx                       ‚Üê Modificado (callback updates)
```

---

## üèóÔ∏è Arquitectura

### Flujo de Datos

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                        products-modern/page.tsx                 ‚îÇ
‚îÇ  - Almacena lista de productos con tags                        ‚îÇ
‚îÇ  - Maneja actualizaciones via callback onTagsUpdate            ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                              ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                          ProductModal                           ‚îÇ
‚îÇ  - Estado local de tags (useState)                              ‚îÇ
‚îÇ  - Pasa producto completo a TagManager                          ‚îÇ
‚îÇ  - Tab "Promociones" muestra tags y TagManager                 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                              ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                          TagManager                             ‚îÇ
‚îÇ  - Modal fullscreen con 2 tabs (Predefinidas/Personalizada)    ‚îÇ
‚îÇ  - Muestra TagSuggestions si hay producto                       ‚îÇ
‚îÇ  - CRUD de tags via API                                         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                              ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                        TagSuggestions                           ‚îÇ
‚îÇ  - Llama suggestTags() de predefinedTags.ts                    ‚îÇ
‚îÇ  - Muestra solo sugerencias no aplicadas                        ‚îÇ
‚îÇ  - Botones one-click para aplicar                               ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                              ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    predefinedTags.ts (Utilities)                ‚îÇ
‚îÇ  - 17 tags con colores, emojis, descripciones                  ‚îÇ
‚îÇ  - 7 funciones helper (getPredefinedTag, suggestTags, etc.)    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### Base de Datos

**Tabla: `product_tags`**

```sql
CREATE TABLE product_tags (
  id          TEXT PRIMARY KEY,
  label       TEXT NOT NULL,
  color       TEXT DEFAULT '#6B7280',
  product_id  TEXT NOT NULL REFERENCES products(id) ON DELETE CASCADE,
  created_at  TIMESTAMP DEFAULT NOW()
);

CREATE INDEX idx_product_tags_product_id ON product_tags(product_id);
CREATE INDEX idx_product_tags_label ON product_tags(label);
```

---

## üß© Componentes

### 1. **TagManager.tsx**

Modal completo de gesti√≥n de etiquetas.

**Props:**

```typescript
interface TagManagerProps {
  productId: string              // ID del producto
  product?: {                    // Producto completo (para sugerencias)
    id: string
    stock: number
    createdAt?: Date | string
    price?: number
  }
  currentTags: ProductTag[]      // Tags actuales del producto
  onTagsUpdate: (tags: ProductTag[]) => void  // Callback al actualizar
}
```

**Caracter√≠sticas:**

- ‚úÖ Bot√≥n de apertura con icono y texto
- ‚úÖ Modal fullscreen con header gradient naranja-√°mbar
- ‚úÖ Muestra tags actuales con botones de eliminar
- ‚úÖ 2 tabs: Predefinidas / Personalizada
- ‚úÖ Integra TagSuggestions al inicio
- ‚úÖ Grid de etiquetas predefinidas con emojis y descripciones
- ‚úÖ Form de etiqueta personalizada con picker de color
- ‚úÖ Indica tags ya aplicadas con check verde
- ‚úÖ Loading states en botones
- ‚úÖ Manejo de errores con alerts

**Estados:**

```typescript
const [isOpen, setIsOpen] = useState(false)
const [customLabel, setCustomLabel] = useState('')
const [customColor, setCustomColor] = useState('#6B7280')
const [loading, setLoading] = useState(false)
const [activeTab, setActiveTab] = useState<'predefined' | 'custom'>('predefined')
```

**M√©todos:**

```typescript
// Agregar tag (POST /api/products/[id]/tags)
const addTag = async (label: string, color: string) => { ... }

// Eliminar tag (DELETE /api/products/[id]/tags?tagId=xxx)
const removeTag = async (tagId: string) => { ... }

// Agregar tag personalizado
const handleAddCustomTag = async () => { ... }
```

---

### 2. **TagSuggestions.tsx**

Panel de sugerencias autom√°ticas basadas en atributos del producto.

**Props:**

```typescript
interface TagSuggestionsProps {
  product: {
    stock: number
    createdAt?: Date | string
    price?: number
  }
  currentTags: string[]          // Labels de tags actuales
  onAddTag: (label: string, color: string) => void
  loading?: boolean
}
```

**Caracter√≠sticas:**

- ‚úÖ Solo se muestra si hay sugerencias disponibles
- ‚úÖ Excluye tags ya aplicados
- ‚úÖ Background gradient azul-√≠ndigo
- ‚úÖ Icono Sparkles ‚ú® para indicar sugerencias
- ‚úÖ Badge con n√∫mero de sugerencias
- ‚úÖ Botones con colores de etiqueta predefinida
- ‚úÖ Texto explicativo del algoritmo
- ‚úÖ Icono üí° con tip informativo

**L√≥gica de Sugerencias:**

```typescript
const suggestions = suggestTags(productForSuggestion)
// Retorna array de labels: ['Disponible', 'Nuevo', 'Premium']

const availableSuggestions = suggestions.filter(label => 
  !currentTags.includes(label)
)
```

---

### 3. **ProductModal.tsx** (Modificado)

Modal de detalles de producto con 4 tabs.

**Cambios Realizados:**

1. **Import TagManager**:
   ```tsx
   import TagManager from './TagManager'
   ```

2. **Estado Local de Tags**:
   ```tsx
   const [tags, setTags] = useState<ProductTag[]>(
     (product.productTags || []).map(tag => ({
       ...tag,
       color: tag.color || '#6B7280'  // Garantiza color no-undefined
     }))
   )
   ```

3. **Callback Handler**:
   ```tsx
   const handleTagsUpdate = (updatedTags: ProductTag[]) => {
     setTags(updatedTags)
     if (onTagsUpdate) {
       onTagsUpdate(updatedTags)
     }
   }
   ```

4. **Tab "Promociones"**:
   ```tsx
   <div className="bg-gradient-to-br from-orange-50 to-amber-50 rounded-lg p-6">
     {/* Tags Display */}
     {tags.length > 0 && (
       <div className="flex flex-wrap gap-3 mb-4">
         {tags.map(tag => (
           <div style={{ backgroundColor: tag.color }}>
             {tag.label}
           </div>
         ))}
       </div>
     )}

     {/* Tag Manager */}
     <TagManager
       productId={product.id}
       product={{ id, stock, createdAt, price }}
       currentTags={tags}
       onTagsUpdate={handleTagsUpdate}
     />
   </div>
   ```

---

### 4. **products-modern/page.tsx** (Modificado)

P√°gina principal de productos con filtros.

**Cambio Principal:**

```tsx
<ProductModal
  product={selectedProduct}
  isOpen={isModalOpen}
  onClose={() => {
    setIsModalOpen(false)
    setSelectedProduct(null)
  }}
  onTagsUpdate={(updatedTags) => {
    // Actualizar producto en lista local
    setProducts(products.map(p => 
      p.id === selectedProduct.id 
        ? { ...p, productTags: updatedTags }
        : p
    ))
    // Actualizar producto seleccionado
    setSelectedProduct({ ...selectedProduct, productTags: updatedTags })
  }}
/>
```

**Beneficio**: Actualizaci√≥n en tiempo real sin recargar p√°gina.

---

## üè∑Ô∏è Etiquetas Predefinidas

### Categor√≠as y Tags

#### 1. **Estado** (3 tags)

| Label | Color | Emoji | Descripci√≥n |
|-------|-------|-------|-------------|
| Nuevo | `#3B82F6` | ‚ú® | Productos recientemente agregados |
| Popular | `#10B981` | üî• | Productos m√°s buscados o vendidos |
| Bestseller | `#8B5CF6` | ‚≠ê | Los productos m√°s vendidos |

#### 2. **Promociones** (3 tags)

| Label | Color | Emoji | Descripci√≥n |
|-------|-------|-------|-------------|
| En oferta | `#F87171` | üí∞ | Productos con descuento |
| Oferta Flash | `#F59E0B` | ‚ö° | Ofertas por tiempo limitado |
| Promoci√≥n | `#EC4899` | üéÅ | Promociones especiales |

#### 3. **Stock** (3 tags)

| Label | Color | Emoji | Descripci√≥n |
|-------|-------|-------|-------------|
| Sin stock | `#6B7280` | ‚ùå | Producto agotado |
| Pocas unidades | `#F59E0B` | ‚ö†Ô∏è | Stock bajo, quedan pocas unidades |
| Disponible | `#10B981` | ‚úÖ | Producto en stock |

#### 4. **Caracter√≠sticas** (3 tags)

| Label | Color | Emoji | Descripci√≥n |
|-------|-------|-------|-------------|
| Org√°nico | `#22C55E` | üå± | Producto org√°nico o ecol√≥gico |
| Premium | `#F59E0B` | üëë | Producto de alta calidad |
| Econ√≥mico | `#06B6D4` | üíµ | Opci√≥n econ√≥mica |

#### 5. **Recurrencia** (2 tags)

| Label | Color | Emoji | Descripci√≥n |
|-------|-------|-------|-------------|
| Recurrente | `#FBBF24` | üîÑ | Productos de compra frecuente |
| Por encargo | `#A855F7` | üìã | Se prepara bajo pedido |

#### 6. **Temporada** (3 tags)

| Label | Color | Emoji | Descripci√≥n |
|-------|-------|-------|-------------|
| Temporada | `#14B8A6` | üóìÔ∏è | Producto de temporada |
| Navidad | `#DC2626` | üéÑ | Especial para √©poca navide√±a |
| Verano | `#F59E0B` | ‚òÄÔ∏è | Producto de temporada de verano |

---

## ü§ñ Sugerencias Autom√°ticas

### Algoritmo `suggestTags()`

Funci√≥n en `lib/predefinedTags.ts` que analiza atributos del producto y retorna array de labels sugeridos.

**Input:**

```typescript
interface ProductForSuggestion {
  stock: number
  createdAt?: Date
  price?: number
}
```

**Output:**

```typescript
string[]  // Ej: ['Disponible', 'Nuevo', 'Premium']
```

### Reglas de Sugerencia

#### 1. **Basado en Stock** (siempre se aplica)

```typescript
if (product.stock === 0) {
  suggestions.push('Sin stock')
} else if (product.stock < 10) {
  suggestions.push('Pocas unidades')
} else {
  suggestions.push('Disponible')
}
```

#### 2. **Basado en Fecha de Creaci√≥n** (opcional)

```typescript
if (product.createdAt) {
  const daysSinceCreation = Math.floor(
    (Date.now() - product.createdAt.getTime()) / (1000 * 60 * 60 * 24)
  )
  if (daysSinceCreation <= 30) {
    suggestions.push('Nuevo')
  }
}
```

**Criterio**: Productos con menos de 30 d√≠as son "Nuevo" ‚ú®

#### 3. **Basado en Precio** (opcional)

```typescript
if (product.price && product.price > 100) {
  suggestions.push('Premium')
}
```

**Criterio**: Productos con precio > $100 son "Premium" üëë

### Ejemplo Completo

**Producto:**

```typescript
{
  id: "abc123",
  stock: 5,
  createdAt: new Date('2025-01-15'),  // 15 d√≠as atr√°s
  price: 150
}
```

**Sugerencias Generadas:**

```typescript
suggestTags(product)
// Retorna: ['Pocas unidades', 'Nuevo', 'Premium']
```

**Visualizaci√≥n en UI:**

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ ‚ú® Etiquetas Sugeridas                      3      ‚îÇ
‚îÇ Basado en stock, precio y fecha de creaci√≥n       ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ [‚ö†Ô∏è Pocas unidades] [‚ú® Nuevo] [üëë Premium]       ‚îÇ
‚îÇ üí° Estas etiquetas se generaron autom√°ticamente   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üîß Uso e Integraci√≥n

### Implementaci√≥n en Nueva P√°gina

Si quieres agregar el sistema de tags en otra p√°gina:

#### Paso 1: Importar Componentes

```tsx
import TagManager from '@/components/products/TagManager'
import TagSuggestions from '@/components/products/TagSuggestions'
import { predefinedTags } from '@/lib/predefinedTags'
```

#### Paso 2: Estado de Tags

```tsx
const [tags, setTags] = useState<ProductTag[]>(product.productTags || [])
```

#### Paso 3: Renderizar TagManager

```tsx
<TagManager
  productId={product.id}
  product={{
    id: product.id,
    stock: product.stock,
    createdAt: product.createdAt,
    price: product.price
  }}
  currentTags={tags}
  onTagsUpdate={(updatedTags) => {
    setTags(updatedTags)
    // Tu l√≥gica adicional aqu√≠
  }}
/>
```

### Uso de Utilidades

#### Obtener Tag Predefinido

```typescript
import { getPredefinedTag } from '@/lib/predefinedTags'

const tag = getPredefinedTag('Nuevo')
// { label: 'Nuevo', color: '#3B82F6', description: '...', icon: '‚ú®' }
```

#### Filtrar por Categor√≠a

```typescript
import { getTagsByCategory } from '@/lib/predefinedTags'

const promoTags = getTagsByCategory('promociones')
// [
//   { label: 'En oferta', color: '#F87171', ... },
//   { label: 'Oferta Flash', color: '#F59E0B', ... },
//   { label: 'Promoci√≥n', color: '#EC4899', ... }
// ]
```

#### Validar Color Hex

```typescript
import { isValidColor } from '@/lib/predefinedTags'

isValidColor('#3B82F6')  // true
isValidColor('#XYZ123')  // false
isValidColor('blue')     // false
```

#### Generar Color Aleatorio

```typescript
import { generateRandomColor } from '@/lib/predefinedTags'

const randomColor = generateRandomColor()
// Retorna uno de: #3B82F6, #10B981, #F59E0B, #F87171, #8B5CF6,
//                 #EC4899, #14B8A6, #F97316, #06B6D4, #84CC16
```

#### Formatear Label con Emoji

```typescript
import { formatTagLabel } from '@/lib/predefinedTags'

formatTagLabel('Nuevo')        // '‚ú® Nuevo'
formatTagLabel('En oferta')    // 'üí∞ En oferta'
formatTagLabel('Custom Label') // 'üè∑Ô∏è Custom Label' (emoji por defecto)
```

---

## üì° API Reference

### Endpoints Existentes

#### 1. **GET** `/api/products/[id]/tags`

Obtiene todas las etiquetas de un producto.

**Response:**

```json
{
  "tags": [
    {
      "id": "tag_abc123",
      "label": "Nuevo",
      "color": "#3B82F6",
      "productId": "prod_xyz",
      "createdAt": "2025-01-30T10:00:00Z"
    }
  ]
}
```

#### 2. **POST** `/api/products/[id]/tags`

Crea una nueva etiqueta para un producto.

**Request Body:**

```json
{
  "label": "Nuevo",
  "color": "#3B82F6"  // Opcional, default: #6B7280
}
```

**Validaciones:**
- ‚úÖ Label requerido (no vac√≠o)
- ‚úÖ No duplicados (misma etiqueta para mismo producto)
- ‚úÖ Color opcional (usa default si no se provee)
- ‚úÖ Auth con Clerk (userId requerido)

**Response:**

```json
{
  "tag": {
    "id": "tag_new123",
    "label": "Nuevo",
    "color": "#3B82F6",
    "productId": "prod_xyz",
    "createdAt": "2025-01-30T10:30:00Z"
  }
}
```

#### 3. **DELETE** `/api/products/[id]/tags?tagId=xxx`

Elimina una etiqueta espec√≠fica.

**Query Params:**
- `tagId` (required): ID de la etiqueta a eliminar

**Response:**

```json
{
  "message": "Tag eliminado correctamente"
}
```

---

## üß™ Testing

### Checklist Manual

#### Test 1: Ver Etiquetas Predefinidas

1. Ir a `/products-modern`
2. Hacer clic en un producto
3. Ir al tab "Promociones"
4. Hacer clic en "Gestionar Etiquetas"
5. ‚úÖ Debe mostrar 17 etiquetas con emojis y colores
6. ‚úÖ Cada tag debe tener descripci√≥n
7. ‚úÖ Tags ya aplicados deben mostrar check verde

#### Test 2: Agregar Etiqueta Predefinida

1. En TagManager, seleccionar tab "Etiquetas Predefinidas"
2. Hacer clic en "Nuevo" (azul con ‚ú®)
3. ‚úÖ Debe agregarse al producto inmediatamente
4. ‚úÖ Debe aparecer en "Etiquetas actuales"
5. ‚úÖ Debe mostrar check verde en la lista
6. ‚úÖ Tag debe aparecer en ProductCard sin recargar

#### Test 3: Crear Etiqueta Personalizada

1. En TagManager, seleccionar tab "Etiqueta Personalizada"
2. Ingresar nombre: "Super Oferta"
3. Seleccionar color: `#FF6B9D`
4. Hacer clic en "Agregar Etiqueta Personalizada"
5. ‚úÖ Debe aparecer en "Etiquetas actuales"
6. ‚úÖ Debe tener el color seleccionado
7. ‚úÖ Contador debe incrementar

#### Test 4: Eliminar Etiqueta

1. En "Etiquetas actuales", hacer clic en X de una tag
2. ‚úÖ Debe desaparecer inmediatamente
3. ‚úÖ Contador debe decrementar
4. ‚úÖ Debe poder volver a agregarse
5. ‚úÖ No debe mostrar check verde en predefinidas

#### Test 5: Sugerencias Autom√°ticas

**Caso A: Producto nuevo con bajo stock**

```typescript
product = {
  stock: 5,
  createdAt: new Date(),  // hoy
  price: 50
}
```

‚úÖ Debe sugerir: "Pocas unidades", "Nuevo"

**Caso B: Producto caro con stock normal**

```typescript
product = {
  stock: 100,
  createdAt: new Date('2024-01-01'),
  price: 250
}
```

‚úÖ Debe sugerir: "Disponible", "Premium"

**Caso C: Producto sin stock**

```typescript
product = {
  stock: 0,
  createdAt: new Date('2023-01-01'),
  price: 10
}
```

‚úÖ Debe sugerir solo: "Sin stock"

#### Test 6: Sugerencias No Duplican

1. Aplicar manualmente "Nuevo" al producto
2. Abrir TagManager
3. ‚úÖ "Nuevo" NO debe aparecer en sugerencias
4. ‚úÖ Otras sugerencias deben mostrarse normalmente

#### Test 7: Filtrado por Etiqueta

1. Crear varios productos con diferentes tags
2. En `/products-modern`, usar selector de tag
3. Seleccionar "Nuevo"
4. ‚úÖ Solo deben aparecer productos con tag "Nuevo"
5. Cambiar a "En oferta"
6. ‚úÖ Debe filtrar correctamente
7. Seleccionar "Todos"
8. ‚úÖ Debe mostrar todos los productos

#### Test 8: Validaci√≥n de Duplicados

1. Agregar tag "Nuevo" a un producto
2. Intentar agregar "Nuevo" nuevamente
3. ‚úÖ Debe mostrar error "Tag ya existe para este producto"
4. ‚úÖ No debe crear duplicado en base de datos

---

## üìä Estad√≠sticas del Sistema

### L√≠neas de C√≥digo

| Archivo | L√≠neas | Funcionalidad |
|---------|--------|---------------|
| `predefinedTags.ts` | 220+ | Definiciones y utilidades |
| `TagManager.tsx` | 300+ | Modal de gesti√≥n |
| `TagSuggestions.tsx` | 80+ | Panel de sugerencias |
| **TOTAL NUEVO** | **600+** | Sistema completo de tags |

### Archivos Modificados

| Archivo | L√≠neas Cambiadas | Cambio Principal |
|---------|------------------|------------------|
| `ProductModal.tsx` | ~50 | Integraci√≥n TagManager |
| `ProductCard.tsx` | ~20 | Display de tags con colores |
| `page.tsx` | ~15 | Callback onTagsUpdate |

---

## üöÄ Pr√≥ximas Mejoras

### Fase 2 (Futuro)

1. **Analytics de Tags**
   - Dashboard con tags m√°s usados
   - Gr√°fico de distribuci√≥n
   - Tags sin uso (report)

2. **Templates de Tags**
   - Guardar combinaciones comunes
   - Ej: "Lanzamiento" = Nuevo + En oferta + Popular
   - Aplicar template con un clic

3. **Tags Compartidos**
   - Tags globales vs por vendedor
   - Permisos de creaci√≥n

4. **Auto-tagging Avanzado**
   - Machine learning para sugerir tags
   - Basado en historial de ventas
   - An√°lisis de descripci√≥n de producto

5. **Notificaciones**
   - Alert cuando producto "Nuevo" cumpla 30 d√≠as
   - Sugerir remover "Pocas unidades" cuando stock aumente

---

## üìù Notas Finales

### Estado del Sistema

‚úÖ **100% Funcional**
- Backend: API completa con validaciones
- Frontend: UI moderna y responsiva
- Database: Relacional con √≠ndices
- Utilidades: 7 funciones helper
- Documentaci√≥n: Completa

### Bugs Conocidos

‚ùå **Ninguno reportado**

### Breaking Changes

‚ö†Ô∏è **Ninguno** - Sistema completamente retrocompatible

---

**√öltima actualizaci√≥n**: 30 de enero de 2025  
**Versi√≥n**: 1.0.0  
**Autor**: Sistema de Etiquetas Predefinidas - Food Orders CRM
